<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¶å¯å¤¢å¤§äº‚é¬¥-ç™»å…¥</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body { background: #1a1a2e; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; margin: 0; }
        .box { background: #16213e; padding: 40px; border-radius: 15px; border: 2px solid #0f3460; width: 300px; text-align: center; }
        input, select { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: none; box-sizing: border-box; }
        button { width: 100%; padding: 10px; margin-top: 10px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-login { background: #e94560; color: white; } .btn-login:hover { background: #c0392b; }
        .btn-toggle { background: transparent; color: #4cc9f0; margin-top: 10px; }
    </style>
</head>
<body>
    <div id="app" class="box">
        <h2 style="color:#f1c40f">ğŸ”¥ å¯¶å¯å¤¢å¤§äº‚é¬¥ ğŸ”¥</h2>
        <div v-if="isLogin">
            <input v-model="form.username" placeholder="å¸³è™Ÿ">
            <input v-model="form.password" type="password" placeholder="å¯†ç¢¼">
            <button class="btn-login" @click="login">ç™»å…¥</button>
            <button class="btn-toggle" @click="isLogin=false">æ²’æœ‰å¸³è™Ÿï¼Ÿè¨»å†Š</button>
        </div>
        <div v-else>
            <input v-model="form.username" placeholder="è¨­å®šå¸³è™Ÿ">
            <input v-model="form.password" type="password" placeholder="è¨­å®šå¯†ç¢¼">
            <select v-model="form.starter_id">
                <option value="1">å¦™è›™ç¨®å­</option>
                <option value="2">å°ç«é¾</option>
                <option value="3">å‚‘å°¼é¾œ</option>
            </select>
            <button class="btn-login" style="background:#27ae60" @click="register">é–‹å§‹å†’éšª</button>
            <button class="btn-toggle" @click="isLogin=true">å·²æœ‰å¸³è™Ÿï¼Ÿç™»å…¥</button>
        </div>
    </div>
    <script>
        const API_URL = 'https://mwtpokemons.zeabur.app/api/v1/auth'; // âš ï¸ è«‹ç¢ºèªé€™æ˜¯ä½ çš„ç¶²å€
        
        Vue.createApp({
            setup() {
                const isLogin = Vue.ref(true);
                const form = Vue.ref({ username: '', password: '', starter_id: 1 });

                const login = async () => {
                    const formData = new URLSearchParams();
                    formData.append('username', form.value.username);
                    formData.append('password', form.value.password);
                    try {
                        const res = await fetch(`${API_URL}/token`, { method: 'POST', body: formData });
                        if(res.ok) {
                            const data = await res.json();
                            localStorage.setItem('token', data.access_token);
                            window.location.href = '/';
                        } else alert("ç™»å…¥å¤±æ•—");
                    } catch(e) { alert("é€£ç·šéŒ¯èª¤"); }
                };

                const register = async () => {
                    try {
                        const res = await fetch(`${API_URL}/register`, {
                            method: 'POST', headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify(form.value)
                        });
                        if(res.ok) { alert("è¨»å†ŠæˆåŠŸï¼è«‹ç™»å…¥"); isLogin.value = true; } 
                        else { const d = await res.json(); alert(d.detail); }
                    } catch(e) { alert("é€£ç·šéŒ¯èª¤"); }
                };
                return { isLogin, form, login, register };
            }
        }).mount('#app');
    </script>
</body>
</html>